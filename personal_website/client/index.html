<!DOCTYPE html>
<html ng-app="app">
	<head>
		<meta charset="utf-8">
		<title>Tommy Oh | Full Stack Developer</title>
		<link rel="icon" type="image/x-icon" href="/static/img/my_face.ico">

		<!-- load jquery -->
		<script type="text/javascript" src="/static/js/jquery.min.js"></script>
		<!-- load bootstrap javascript -->
		<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
		<!-- load font-awesome js -->
		<!-- <script src="https://use.fontawesome.com/9abc27e70e.js"></script> -->
		<script type="text/javascript" src="/static/js/font-awesome.min.js"></script>
		<!-- load style CSS -->
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-social.css">
		<link rel="stylesheet" type="text/css" href="/static/css/style.css">

		<!-- load angularJS and its dependencies -->
		<script type="text/javascript" src="/static/js/angular.min.js"></script>
		<script type="text/javascript" src="/static/js/angular-route.min.js"></script>
		<script type="text/javascript" src="/static/js/angular-cookies.min.js"></script>
		<script type="text/javascript" src="/static/js/angular-flash.min.js"></script>

		<!-- load angular.module and config -->
		<!-- load factories: usersFactory, topicsFactory -->
		<!-- load controllers: UserController, DashboardController, TopicController, ProfileController -->

		<script type="text/javascript">
			var app = angular.module("app", ['ngRoute', 'ngCookies', 'ngFlash']);

			app.config(['$routeProvider', function($routeProvider) {
				$routeProvider
					.when('/home', {
						templateUrl: "static/partials/home.html"
					})
					.when('/me', {
						templateUrl: "static/partials/me.html",
						controller: 'MeController'
					})
					.when('/resume', {
						templateUrl: "static/partials/resume.html"
					})
					.when('/contact', {
						templateUrl: "static/partials/contact.html",
						controller: 'ContactController'
					})
					.when('/skills', {
						templateUrl: "static/partials/skill_storage.html",
						controller: 'SkillStorageController'
					})
					.when('/self', {
						templateUrl: "static/partials/self_qa.html",
						controller: 'SelfController'
					})
					.when('/daily', {
						templateUrl: "static/partials/daily_plan.html"
					})
					.when('/login', {
						templateUrl: "static/partials/login.html",
						controller: "LoginController"
					})
					.otherwise({
						redirectTo: '/home'
					});
			}]);

			// usersFactory
			app.factory("usersFactory", ['$http', function($http) {

				function UsersFactory() {

					this.register = function(newUser, callback) {
						$http.post('/register', newUser).then(
							function success(response) {
								if (typeof(response.data.errors) != 'undefined') {
									callback(false, response.data.errors);
								}
								else {
									callback(true, response.data);
								}
							},
							function error(response) {
								console.log("[register: ERROR] server has failed to register a new user.");
							}
						);
					}

				}

				return new UsersFactory();
			}]);

			// contactsFactory
			app.factory("contactsFactory", ['$http', function($http) {

				function ContactsFactory() {

					this.send_email = function(newMessage, callback) {
						console.log(newMessage);
						$http.post('/contact/email', newMessage).then(
							function success(response) {
								// if there is an error key, send the error.
								if (typeof(response.data.error) != 'undefined') {
									callback(false, response.data.error);
								}
								else {
									// else send back the success message
									callback(true, response.data.success);
								}
							},
							function error(response) {
								console.log("[send_email: ERROR] the server has failed to send email to Tommy!");
							}
						);
					}

				}

				return new ContactsFactory;
			}]);

			// ContactController
			app.controller("ContactController", ['$scope', '$location', '$cookies', 'contactsFactory', 'Flash', function($scope, $location, $cookies, contactsFactory, Flash) {

				$scope.send_email = function() {
					contactsFactory.send_email($scope.newMessage, function(status, response) {
						if (status == false) {
							// show flash message for error
							Flash.create('danger', response);
						}
						else {
							$scope.newMessage = {}; // clear the contact form
							// show flash message for confirmation
							Flash.create('success', response);
						}
					});
				}

			}]);

			// MeController
			app.controller('MeController', ['$scope', function($scope) {

				$scope.showMeaning = false;
				$scope.hoverInCerca = function() {
					$scope.showMeaning = true;
					$scope.stylePhoto = {
						'border': '8px groove rgba(255, 202, 81, 0.7)',
					};
				}

				$scope.hoverOutMeaning = function() {
					$scope.showMeaning = false;
					$scope.stylePhoto = {};
				}
			}]);

			// SkillStorageController
			app.controller('SkillStorageController', ['$scope', function($scope) {

				// CURRENT EQUIPMENTS
				$scope.current = {
					technologies: 	[	"MongoDB",
										"Express",
										"Angular.js",
										"Node.js",
										"Javascript",
										"HTML / HTML5",
										"CSS / CSS3",
										"Twitter Bootstrap",
										"Git / Github & Terminal",
										"AJAX", "APIs",
										"Amazon Web Service (AWS)",
										"Linux Server via AWS",
										"socket.io",
										"npm / bower"
									],
					skills: [	"Full Stack Development (MEAN)",
								"Responsive Web Design",
								"Front-end Development",
								"Wireframes & Mockups",
								"Code Version Control",
								"HTTP Request",
								"Dynamic Content",
								"CRUD Operations",
								"OOP in Javascript",
								"AJAX Requests",
								"MVC Framework / Design",
								"Building Real-time Apps",
								"NoSQL Database Design",
								"RESTful Routing",
								"Web Socket Connection"
							]
				}

				// INVENTORY
				$scope.inventory = {
					technologies: 	[	"LESS",
										"jQuery",
										"jQuery-UI",
										"Python",
										"Flask",
										"Django",
										"MySQL",
										"SQLite",
										"Balsamiq"
									],
					skills:	[	"Full Stack Development (Python)",
								"OOP in Python",
								"SQL Queries",
								"ERD Diagrams",
								"Object Relational Mapper",
								"Relational Database Design",
								"Web Crawler",
								"Test-Driven Development (TDD)",
								"Creating Custom JS libraries"
							]
				}

				// WISHLIST
				$scope.wishlist = {
					technologies: 	[
									],
					skills:	[	"SASS",
								"ReactJS"
							]
				}

			}]);


			app.controller("SelfController", ['$scope', '$location', '$cookies', 'Flash', function($scope, $location, $cookies, Flash) {
				$scope.login_status = false;

				// immediate function to prevent non logged-in user access
				(function() {
					// if cookie does not exist, redirect client to the login page
					if ($cookies.get('username') != undefined) {
						$scope.login_status = true;
						$scope.username = $cookies.get('username');
					}
					// if ($cookies.get('newUser_log') != undefined) {
					// 	Flash.create("success", "successfully registered! Welcome, " + $scope.username +"!");
					// 	// then remove the cookies right away. one time use only
					// 	$cookies.remove('newUser_log');
					// }

				})();


				// store user's current page. this is for login and back to current page
				$scope.currentPage = function() {
					$cookies.put("currentPage", "/self");
				};

				$scope.logout = function() {
					$cookies.remove("username");
					$cookies.remove("authority_level");

					$scope.login_status = false;
					Flash.create("success", "You have successfully logged out!");
				}
			}]);

			app.controller("LoginController", ['$scope', '$location', '$cookies', 'Flash', 'usersFactory', function($scope, $location, $cookies, Flash, usersFactory) {
				$scope.newUser = {};

				$scope.register = function() {
					usersFactory.register($scope.newUser, function(status, response) {
						if (status == false) {
							Flash.clear();
							// send back error
							var errors = [];
							for (var x in response) {
								errors.push(response[x].message);
							}
							errors.reverse();
							for (var i = 0, j = errors.length; i < j; i++) {
								Flash.create('danger', errors[i]);
							}
						}
						else {
							Flash.clear(); // clear errors
							$scope.newUser = {} // clear register form
							// save username and authority_level in cookies
							$cookies.put("username", response.username);
							$cookies.put("authority_level", response.authority_level);
							// $cookies.put("newUser_log", "trigger");

							console.log($cookies.get("username"));
							console.log($cookies.get("authority_level"));
							location.reload();
							$location.url($cookies.get("currentPage"));

							// back to where the user was originally from using $cookies
							// then redirect to that page
						}
					});
				}
			}]);

		</script>
	</head>
	<body>
		<div ng-view="">
			<!-- partials to be loaded in this div. -->
		</div>

		<!-- FOOTER -->
		<footer class="footer">
			<div class="container text-center">
				<p class="text-muted">
					<small>&copy; 2016 By Tommy Oh &middot;</small>
					<a target="_blank" href="https://github.com/fobbytommy" class="btn btn-social-icon btn-github btn-xs">
						<i class="fa fa-github" aria-hidden="true"></i>
					</a> <small>&middot;</small>
					<a target="_blank" href="https://www.linkedin.com/in/tommy-oh" class="btn btn-social-icon btn-linkedin btn-xs">
						<i class="fa fa-linkedin" aria-hidden="true"></i>
					</a>
				</p>
			</div>
		</footer>
	</body>
</html>
